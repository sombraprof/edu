import{p as C,r as M}from"./hljs-utils-BZutKiLg.js";import{G as O,a as q}from"./GlobalLoader-CQEiVoIX.js";import{v as j,x,r as p,y as D,j as $,i as G,z as N,A as B,B as P,_ as V,l as S,o as g,b as L,g as E,e as F,h as R,n as U}from"./index-6tz7n0Hg.js";let z;function I(){return z}function J(n){return typeof n=="function"?n():x(n)}function b(n){if(n instanceof Promise||n instanceof Date||n instanceof RegExp)return n;const o=J(n);if(!n||!o)return o;if(Array.isArray(o))return o.map(e=>b(e));if(typeof o=="object"){const e={};for(const t in o)if(Object.prototype.hasOwnProperty.call(o,t)){if(t==="titleTemplate"||t[0]==="o"&&t[1]==="n"){e[t]=x(o[t]);continue}e[t]=b(o[t])}return e}return o}const K="usehead",T=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},k="__unhead_injection_handler__";function Y(){return k in T?T[k]():j(K)||I()}function Z(n,o={}){const e=o.head||Y();if(e)return e.ssr?e.push(n,o):Q(e,n,o)}function Q(n,o,e={}){const t=p(!1),r=p({});D(()=>{r.value=t.value?{}:b(o)});const c=n.push(r.value,e);return $(r,a=>{c.patch(a)}),P()&&(G(()=>{c.dispose()}),N(()=>{t.value=!0}),B(()=>{t.value=!1})),c}function W(n){if(n){try{n.querySelectorAll(".accordion-toggle").forEach(e=>{e.setAttribute("aria-controls",e.id?e.id+"-panel":""),e.setAttribute("aria-expanded","false");const r=(e.closest(".card, div, section")||n).querySelector(".accordion-content");r&&(r.style.maxHeight="0px",r.setAttribute("hidden",""),r.setAttribute("role","region"),e.addEventListener("click",()=>{if(r.hasAttribute("hidden")===!1){r.style.maxHeight="0px",r.setAttribute("hidden",""),e.setAttribute("aria-expanded","false");try{e.querySelector(".transform")?.classList.remove("rotate-180")}catch(s){console.warn("Operação não crítica falhou:",s)}}else{r.removeAttribute("hidden");const s=r.scrollHeight;r.style.maxHeight=s+"px",e.setAttribute("aria-expanded","true");try{e.querySelector(".transform")?.classList.add("rotate-180")}catch(a){console.warn("Operação não crítica falhou:",a)}}}))})}catch(o){console.warn("Operação não crítica falhou:",o)}try{n.querySelectorAll(".aspect-video").forEach(e=>{if(e.querySelector("iframe, video, embed, object"))return;let r=e.getAttribute("data-src")||e.dataset?.src||e.querySelector('a[href^="http"]')?.getAttribute("href")||e.parentElement?.querySelector('a[href^="http"]')?.getAttribute("href");if(r&&(r=(d=>{try{const i=new URL(d,window.location.href);return/youtube\.com$/i.test(i.hostname)||/youtu\.be$/i.test(i.hostname)?i.hostname.includes("youtu.be")?`https://www.youtube-nocookie.com/embed/${i.pathname.replace(/^\//,"")}`:d.replace("www.youtube.com","www.youtube-nocookie.com").replace("youtube.com","youtube-nocookie.com"):d}catch{return d}})(r)),!r)return;try{const i=new URL(r,window.location.href).hostname,m=/youtube\.com$/i.test(i)||/youtu\.be$/i.test(i)||i.includes("youtube-nocookie"),v=/vimeo\.com$/i.test(i)||i.includes("player.vimeo.com");if(!(m||v))return}catch{return}const a=e.closest(".card")?.querySelector("h3, h4, h5")?.textContent?.trim()||"Vídeo",l=document.createElement("iframe");l.setAttribute("src",r),l.setAttribute("title",a),l.setAttribute("frameborder","0"),l.setAttribute("allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"),l.setAttribute("allowfullscreen",""),l.setAttribute("loading","lazy"),l.setAttribute("referrerpolicy","strict-origin-when-cross-origin"),e.appendChild(l)})}catch(o){console.warn("Operação não crítica falhou:",o)}try{n.querySelectorAll("pre > code").forEach(e=>{const t=e.parentElement;if(!t||t.dataset.enhancedCopy==="1")return;t.dataset.enhancedCopy="1";const r=document.createElement("div");r.className="code-block relative",t.parentNode.insertBefore(r,t),r.appendChild(t);const c=document.createElement("button");c.type="button",c.className="copy-code-btn btn btn-icon btn-tonal absolute top-2 right-2",c.setAttribute("aria-label","Copiar código"),c.setAttribute("title","Copiar código"),c.innerHTML='<i class="fa-solid fa-copy"></i>',r.appendChild(c),c.addEventListener("click",async()=>{try{const s=e.innerText||"";s&&await navigator.clipboard?.writeText(s),window.__showSnackbar&&window.__showSnackbar("Código copiado")}catch(s){console.warn("Operação não crítica falhou:",s)}},{passive:!0})})}catch(o){console.warn("Operação não crítica falhou:",o)}try{const o=n.querySelectorAll("p, li, h4, h5, h6, span, div"),e=/\*\*([A-Za-zÀ-ÿ0-9_.,;:()\/\\\-\s]{1,40})\*\*/g;o.forEach(t=>{if(!t.closest("pre, code")){if(!t.innerHTML||t.childElementCount>0){t.innerHTML&&t.innerHTML.includes("**")&&(t.innerHTML=t.innerHTML.replace(e,"<code-text>$1</code-text>"));return}t.textContent.includes("**")&&(t.innerHTML=t.innerHTML.replace(e,"<code-text>$1</code-text>"))}})}catch(o){console.warn("Operação não crítica falhou:",o)}}}const f={error:(n,o={})=>{console.error(`[LessonView] ${n}`,{timestamp:new Date().toISOString(),...o})},info:(n,o={})=>{console.info(`[LessonView] ${n}`,{timestamp:new Date().toISOString(),...o})}},X={name:"LessonView",components:{GlobalAlert:q,GlobalLoader:O},props:{id:{type:String,required:!0}},setup(n){const o=p(!0),e=p(null),t=p(""),r=p("Lesson"),c=Object.assign({}),s=async a=>{try{if(o.value=!0,e.value=null,f.info("Starting lesson load",{lessonId:a}),!a||typeof a!="string")throw new Error("Invalid lesson ID provided");const l=new AbortController,d=setTimeout(()=>l.abort(),1e4);try{const i=await fetch("/algi/lessons/lessons.json",{signal:l.signal});if(clearTimeout(d),!i.ok)throw new Error(`Failed to load lessons metadata: ${i.status} ${i.statusText}`);const m=await i.json(),h=(Array.isArray(window.__LESSONS_META)?window.__LESSONS_META:m).find(u=>u.id===a);if(!h)throw new Error(`Lesson with ID "${a}" not found in metadata`);if(!h.ativo)throw new Error("This lesson is not available yet");r.value=h.titulo||`Lesson ${a}`;const A=h.arquivo||`${a}.html`,_=`/public/lessons/${A}`;if(!c[_])throw new Error(`Lesson file not found in build: ${A}`);const H=await c[_]();t.value=C.sanitize(H,{ADD_TAGS:["md3-video","md3-callout","md3-checkbox","md3-external","iframe"],ADD_ATTR:["title","src","allow","variant","label","checked","href","icon","target","rel","allowfullscreen","frameborder","loading","referrerpolicy"]});try{if(window.localStorage){const u=JSON.parse(localStorage.getItem("visited_lesson")||"[]");u.includes(a)||(u.push(a),localStorage.setItem("visited_lesson",JSON.stringify(u)))}}catch(u){f.error("Failed to save lesson visit to localStorage",{lessonId:a,error:u.message})}await U();try{const u=document.querySelector("#main-root .md3-content")||document.getElementById("main-root");u&&(W(u),u.querySelectorAll('a[href^="http"]').forEach(y=>{try{y.setAttribute("target","_blank")}catch(w){f.error("Failed to set link attributes",{href:y.href,error:w.message})}try{y.setAttribute("rel","noopener noreferrer")}catch(w){f.error("Failed to set link rel",{href:y.href,error:w.message})}})),M()}catch(u){f.error("Failed to enhance lesson content",{lessonId:a,error:u.message})}f.info("Lesson loaded successfully",{lessonId:a,title:r.value}),Z({title:`${r.value} - ALGI`,meta:[{name:"description",content:h.descricao||`Aprenda ${r.value} no curso de Algoritmos e Lógica de Programação`},{property:"og:title",content:`${r.value} - ALGI`},{property:"og:description",content:h.descricao||`Aprenda ${r.value} no curso de Algoritmos e Lógica de Programação`},{property:"og:type",content:"article"}]})}catch(i){throw clearTimeout(d),i.name==="AbortError"?new Error("Request timeout - please check your internet connection"):i}}catch(l){const d=l.message||"An unexpected error occurred while loading the lesson";e.value=d,f.error("Failed to load lesson",{lessonId:a,error:d,stack:l.stack})}finally{o.value=!1}};return R(()=>{s(n.id)}),$(()=>n.id,a=>{a&&s(a)}),{loading:o,error:e,lessonContent:t,lessonTitle:r}}},ee={key:2},te=["innerHTML"];function oe(n,o,e,t,r,c){const s=E("GlobalLoader"),a=E("GlobalAlert");return g(),S("div",null,[t.loading?(g(),L(s,{key:0,title:"Carregando aula",subtitle:"Preparando o conteúdo..."})):t.error?(g(),L(a,{key:1,text:t.error,variant:"error",icon:"fa-solid fa-triangle-exclamation"},null,8,["text"])):(g(),S("div",ee,[F("div",{class:"md3-content pt-6",innerHTML:t.lessonContent},null,8,te)]))])}const ie=V(X,[["render",oe],["__scopeId","data-v-92d378b1"]]);export{ie as default};
