{
  "id": "lesson-23",
  "title": "Aula 23: Profiling e Otimização Multiplataforma",
  "objective": "Diagnosticar gargalos de performance e aplicar otimizações para garantir builds estáveis em PC e dispositivos móveis.",
  "summary": "Apresenta ferramentas de profiling, métricas essenciais, estratégias de otimização e checklist de build pipeline contínuo.",
  "formatVersion": "md3.lesson.v1",
  "slug": "profiling-e-otimizacao-multiplataforma",
  "duration": 100,
  "modality": "in-person",
  "resources": [
    {
      "label": "Unity Profiler Overview",
      "url": "https://docs.unity3d.com/Manual/Profiler.html",
      "type": "guide"
    },
    {
      "label": "Godot Performance Profiling",
      "url": "https://docs.godotengine.org/en/stable/tutorials/performance/index.html",
      "type": "guide"
    },
    {
      "label": "Google Play Performance Class",
      "url": "https://developer.android.com/games/optimize/performance-class",
      "type": "guide"
    }
  ],
  "bibliography": [
    "Unity. Performance Optimization Handbook. 2024.",
    "Nystrom, R. Game Programming Patterns. 2022.",
    "Google. Android Performance Tuning. 2024."
  ],
  "competencies": [
    "Otimização de performance",
    "Profiling em engines de jogos",
    "Planejamento de builds"
  ],
  "outcomes": [
    "Relatório de profiling com métricas antes/depois registrado no GDD.",
    "Ao menos duas otimizações implementadas com evidências no repositório.",
    "Checklist de build atualizado com pipeline documentado."
  ],
  "assessment": {
    "type": "formative",
    "description": "Entrega de relatório de profiling com gráficos e plano de ação priorizado para próxima sprint."
  },
  "content": [
    {
      "type": "lessonPlan",
      "title": "Plano da aula",
      "cards": [
        {
          "icon": "target",
          "title": "Objetivo",
          "content": "Reduzir consumo de CPU/GPU, memória e tempo de loading do protótipo."
        },
        {
          "icon": "monitor",
          "title": "Conteúdos",
          "content": "Métricas críticas, profiling em Unity/Godot, otimização de scripts, assets e build pipeline."
        },
        {
          "icon": "gears",
          "title": "Metodologia",
          "content": "Estudo de caso → diagnóstico guiado → squads otimizando → retro coletiva com plano de ação."
        }
      ]
    },
    {
      "type": "timeline",
      "title": "Roteiro (100 minutos)",
      "steps": [
        {
          "title": "Briefing de métricas (15 min)",
          "content": "Definir metas mínimas: FPS, tempo de loading, uso de memória, tamanho da build e estabilidade."
        },
        {
          "title": "Demonstrando ferramentas (25 min)",
          "content": "Navegar no Unity Profiler/Godot Monitor, analisar CPU, GPU, Rendering, Memory e Data & Profile Analyzer."
        },
        {
          "title": "Laboratório de otimização (40 min)",
          "content": "Squads identificam gargalos e aplicam melhorias (batching, pooling, compressão de textures, redução de draw calls)."
        },
        {
          "title": "Checklist de build (10 min)",
          "content": "Documentar pipeline: plataformas alvo, automação (CI/CD), testes smoke e upload para Itch.io/Google Play testing."
        },
        {
          "title": "Retro e alinhamento (10 min)",
          "content": "Compartilhar aprendizados, registrar dívidas técnicas e definir responsáveis por monitoramento contínuo."
        }
      ]
    },
    {
      "type": "contentBlock",
      "title": "Como transformar dados em ação",
      "content": [
        {
          "type": "paragraph",
          "text": "Profiling só gera resultado quando vira plano de ação. Estruture o trabalho para não ficar preso em gráficos sem decisão."
        },
        {
          "type": "unorderedList",
          "items": [
            "Defina metas claras por plataforma antes de abrir as ferramentas.",
            "Capture sessões representativas (5-10 minutos) com gravação do jogador para contextualizar picos.",
            "Registre cada hipótese de otimização com impacto esperado e esforço estimado."
          ]
        }
      ]
    },
    {
      "type": "videos",
      "title": "Vídeos em português sobre performance",
      "videos": [
        {
          "url": "https://www.youtube.com/watch?v=z3Pjz0_FGuk",
          "title": "Otimizando jogos no Unity – Checklist em PT-BR (Shader Forge Brasil)",
          "caption": "Guia prático em português cobrindo profiling, batching e redução de draw calls."
        },
        {
          "url": "https://www.youtube.com/watch?v=y6g0CcsMEo8",
          "title": "Boas práticas de performance para jogos mobile (Android Dev BR)",
          "caption": "Apresenta métricas oficiais do Android, ferramentas e estratégias para atingir Performance Class."
        }
      ]
    },
    {
      "type": "contentBlock",
      "title": "Estudo de caso – Hyperloop Dash: build instável",
      "content": [
        {
          "type": "paragraph",
          "text": "O protótipo Hyperloop Dash apresentou queda de FPS para 30 em dispositivos Android intermediários durante o vertical slice."
        },
        {
          "type": "paragraph",
          "text": "O time não possuía rotina de profiling e descobriu gargalos de draw calls e scripts sem pooling na véspera da apresentação. Eles precisam criar um plano de choque sem suspender toda a sprint."
        },
        {
          "type": "unorderedList",
          "items": [
            "Plataformas: PC mid-range, Android Performance Class 12",
            "Principais gargalos: Draw calls excessivas, alocação de garbage em habilidades especiais",
            "Prazo: 5 dias até demo pública"
          ]
        },
        {
          "type": "unorderedList",
          "items": [
            "Pergunta: Quais áreas devem ser priorizadas para recuperar FPS rapidamente?",
            "Pergunta: Como garantir que a otimização não quebre funcionalidades já aprovadas?",
            "Pergunta: Que evidências são necessárias para comunicar progresso aos stakeholders?"
          ]
        },
        {
          "type": "unorderedList",
          "items": [
            "Ação sugerida: Monte painel comparando métricas antes/depois para cada ajuste crítico.",
            "Ação sugerida: Implemente automação que gera build diária com relatório de tamanho e tempo de loading.",
            "Ação sugerida: Documente rollback plan caso a otimização introduza regressões."
          ]
        }
      ]
    },
    {
      "type": "contentBlock",
      "title": "Painel de métricas",
      "content": [
        {
          "type": "image",
          "src": "https://docs.unity3d.com/uploads/Main/ProfilerCPU.png",
          "alt": "Captura do Unity Profiler com timeline de CPU",
          "caption": "Use o painel para destacar picos e justificar cada otimização proposta."
        },
        {
          "type": "md3Table",
          "title": "Metas mínimas",
          "headers": ["Indicador", "Meta", "Ferramenta de verificação"],
          "rows": [
            ["FPS médio", ">= 55 (PC) / >= 45 (Android)", "Unity Profiler / Godot Monitor"],
            ["Tempo de loading", "<= 8s", "Unity Profiler Loading / Godot Frame Time"],
            ["Memória", "<= 1,5 GB (PC) / <= 700 MB (Android)", "Memory Profiler"],
            ["Tamanho da build", "<= 1,2 GB", "Build Report"],
            ["Crashes", "0", "Logcat / Godot Debugger"]
          ]
        }
      ]
    },
    {
      "type": "pipelineCanvas",
      "title": "Ciclo de otimização contínua",
      "summary": "Integra profiling, ajustes e validação em cada sprint.",
      "stages": [
        {
          "id": "coleta",
          "title": "1. Coleta",
          "summary": "Captura de dados em sessões de jogo instrumentadas.",
          "status": "in-progress",
          "owners": ["QA"],
          "deliverables": [
            {
              "id": "logs",
              "label": "Logs e capturas do profiler"
            },
            {
              "id": "planilha",
              "label": "Planilha de métricas"
            }
          ]
        },
        {
          "id": "analise",
          "title": "2. Análise",
          "summary": "Priorização de gargalos, definição de hipóteses de otimização.",
          "status": "not-started",
          "owners": ["Tech Lead", "Programador"],
          "deliverables": [
            {
              "id": "hipoteses",
              "label": "Hipóteses registradas"
            },
            {
              "id": "backlog",
              "label": "Tickets no board"
            }
          ]
        },
        {
          "id": "execucao",
          "title": "3. Execução",
          "summary": "Aplicação das otimizações e verificação automatizada.",
          "status": "not-started",
          "owners": ["Programador", "Artista Técnico"],
          "deliverables": [
            {
              "id": "commits",
              "label": "Commits com notas de desempenho"
            },
            {
              "id": "relatorio",
              "label": "Relatório comparativo"
            }
          ]
        }
      ]
    },
    {
      "type": "stepper",
      "title": "Loop diário de otimização",
      "steps": [
        {
          "title": "Captura",
          "description": "Grave sessão representativa, exporte dados do profiler e salve no repositório de métricas."
        },
        {
          "title": "Diagnóstico",
          "description": "Classifique gargalos por impacto e esforço; valide hipóteses com o squad."
        },
        {
          "title": "Implementação",
          "description": "Execute otimizações priorizadas (batching, pooling, compressão) e registre commits atômicos."
        },
        {
          "title": "Validação",
          "description": "Rode testes automatizados e build alvo garantindo que as metas foram atingidas."
        }
      ]
    },
    {
      "type": "quiz",
      "title": "Checagem rápida",
      "question": "Após reduzir draw calls com batching estático, o tempo de loading aumentou. Qual próximo passo é mais adequado?",
      "options": [
        {
          "id": "opt-1",
          "text": "Analisar o relatório de build para identificar assets incluídos desnecessariamente e revisar a estratégia de streaming.",
          "correct": true
        },
        {
          "id": "opt-2",
          "text": "Reverter o batching e aceitar o FPS menor para priorizar loading rápido.",
          "correct": false
        },
        {
          "id": "opt-3",
          "text": "Ignorar o tempo de loading porque ele só afeta a primeira cena do jogo.",
          "correct": false
        }
      ],
      "allowRetry": true,
      "feedback": {
        "correct": "O batching pode aumentar tamanho da build; revisar streaming e assets carregados resolve sem perder FPS.",
        "incorrect": "O batching pode aumentar tamanho da build; revisar streaming e assets carregados resolve sem perder FPS."
      }
    },
    {
      "type": "contentBlock",
      "title": "TED: Relatório de otimização",
      "content": [
        {
          "type": "paragraph",
          "text": "Execute uma sessão de profiling de 10 minutos, registre métricas chave e implemente pelo menos duas otimizações documentadas."
        },
        {
          "type": "checklist",
          "title": "Entregáveis",
          "items": [
            "Relatório (PDF ou Notion) com gráficos antes/depois.",
            "Commit com descrição `OPT_A23` detalhando mudanças.",
            "Plano de próximos passos com responsáveis e métricas alvo."
          ]
        },
        {
          "type": "callout",
          "variant": "warning",
          "title": "Cuidados",
          "content": "Sempre rode smoke test após otimizar; valide se não surgiram regressões de gameplay ou arte."
        }
      ]
    }
  ],
  "metadata": {
    "status": "in-review",
    "updatedAt": "2025-02-10T00:00:00.000Z",
    "owners": ["Prof. Tiago Sombra"],
    "sources": ["Plano de ensino TDJD 2025.2", "Reunião pedagógica TDJD – jan/2025"]
  }
}
