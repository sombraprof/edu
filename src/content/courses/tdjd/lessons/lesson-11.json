{
  "id": "lesson-11",
  "title": "Aula 11: M√©todos, Eventos e Corrotinas",
  "objective": "Utilizar eventos e corrotinas para coordenar fluxos de jogo reativos.",
  "content": [
    {
      "type": "flightPlan",
      "title": "Mapa da aula",
      "items": [
        "Revis√£o: Ciclo de vida MonoBehaviour e m√©todos auxiliares.",
        "Eventos: Criar e ouvir eventos para comunica√ß√£o entre objetos.",
        "Corrotinas: Controlar fluxos temporizados sem travar a thread principal.",
        "Hands-on: Construir uma sequ√™ncia de spawn com feedback audiovisual.",
        "Wrap-up: Registrar aprendizados no GDD t√©cnico."
      ]
    },
    {
      "type": "contentBlock",
      "title": "Delegates e eventos",
      "content": [
        {
          "type": "code",
          "language": "csharp",
          "code": "public class ScoreManager : MonoBehaviour\n{\n    public static event Action OnScoreChanged;\n\n    private int currentScore;\n\n    public void AddPoints(int value)\n    {\n        currentScore += value;\n        OnScoreChanged?.Invoke(currentScore);\n    }\n}\n\npublic class HudScore : MonoBehaviour\n{\n    private void OnEnable() => ScoreManager.OnScoreChanged += UpdateLabel;\n    private void OnDisable() => ScoreManager.OnScoreChanged -= UpdateLabel;\n\n    private void UpdateLabel(int score)\n    {\n        // Atualiza UI\n    }\n}\n"
        },
        {
          "type": "callout",
          "variant": "warning",
          "title": "Cuidado com vazamentos",
          "content": [
            {
              "type": "paragraph",
              "text": "Sempre desinscreva listeners em OnDisable ou OnDestroy para evitar chamadas em objetos destru√≠dos."
            }
          ]
        }
      ]
    },
    {
      "type": "contentBlock",
      "title": "Corrotinas na pr√°tica",
      "content": [
        {
          "type": "code",
          "language": "csharp",
          "code": "public class EnemySpawner : MonoBehaviour\n{\n    [SerializeField] private GameObject enemyPrefab;\n    [SerializeField] private float delay = 1.5f;\n\n    private void OnEnable()\n    {\n        StartCoroutine(SpawnRoutine());\n    }\n\n    private IEnumerator SpawnRoutine()\n    {\n        while (true)\n        {\n            Instantiate(enemyPrefab, transform.position, Quaternion.identity);\n            yield return new WaitForSeconds(delay);\n        }\n    }\n}\n"
        },
        {
          "type": "callout",
          "variant": "info",
          "title": "Boas pr√°ticas",
          "content": [
            {
              "type": "paragraph",
              "text": "Prefira yield return null para esperar um frame e WaitForSeconds para intervalos. Para parar, use StopCoroutine ou controle booleano."
            }
          ]
        }
      ]
    },
    {
      "type": "contentBlock",
      "title": "Desafio guiado",
      "content": [
        {
          "type": "orderedList",
          "items": [
            {
              "title": "Gatilho de evento",
              "text": "Quando o jogador coleta um item, dispare um evento que atualiza HUD e reproduz som."
            },
            {
              "title": "Sequ√™ncia temporizada",
              "text": "Implemente uma corrotina que pisca luzes antes da apari√ß√£o do chefe."
            },
            {
              "title": "Finaliza√ß√£o",
              "text": "Ao derrotar o chefe, pare todas as corrotinas ativas e exiba mensagem de vit√≥ria."
            }
          ]
        }
      ]
    },
    {
      "type": "contentBlock",
      "title": "üìù Mini-teste rel√¢mpago (Moodle)",
      "content": [
        {
          "type": "paragraph",
          "text": "Complete o mini-teste individual e envie as respostas no Moodle > Aula 11 > Mini-teste at√© 23h59."
        },
        {
          "type": "orderedList",
          "items": [
            {
              "title": "Quest√£o 1",
              "text": "Explique, em at√© 3 linhas, quando preferir eventos em vez de chamadas diretas entre componentes."
            },
            {
              "title": "Quest√£o 2",
              "text": "Descreva a diferen√ßa entre yield return null e WaitForSeconds(2f) dentro de uma corrotina."
            },
            {
              "title": "Quest√£o 3",
              "text": "Indique um risco comum ao n√£o cancelar corrotinas ao trocar de cena e como mitig√°-lo."
            }
          ]
        },
        {
          "type": "paragraph",
          "text": "Formato do envio: um PDF ou texto direto no Moodle contendo respostas numeradas. Nomeie o arquivo como TURMA_SOBRENOME_A11.pdf."
        }
      ]
    },
    {
      "type": "callout",
      "variant": "warning",
      "title": "Revis√£o individual obrigat√≥ria",
      "content": [
        {
          "type": "paragraph",
          "text": "Ap√≥s o envio, reserve 15 minutos para revisar sua pr√≥pria cena: execute o build, valide logs e registre ajustes necess√°rios no GDD t√©cnico."
        }
      ]
    },
    {
      "type": "contentBlock",
      "title": "üóíÔ∏è Template de feedback linha a linha",
      "content": [
        {
          "type": "code",
          "language": "markdown",
          "code": "| Linha | Contexto | Coment√°rio | A√ß√£o Pr√≥xima |\n|-------|----------|------------|--------------|\n| 12    | EnemySpawner.cs | Evento dispara duas vezes | Consolidar unsubscribe em OnDisable |\n| 27    | BossSequence.cs | Coroutine n√£o cancela | Adicionar StopCoroutine no fim do combate |"
        }
      ]
    },
    {
      "type": "checklist",
      "title": "Pronto para seguir?",
      "items": [
        "Eventos n√£o disparam m√∫ltiplas vezes para o mesmo listener.",
        "Corrotinas s√£o interrompidas corretamente ao sair da cena.",
        "Fluxos documentados no reposit√≥rio com coment√°rios e README atualizado."
      ]
    }
  ],
  "formatVersion": "md3.lesson.v1",
  "slug": "metodos-eventos-e-corrotinas",
  "summary": "Aprofunda scripts em C# trabalhando com m√©todos, eventos Unity e corrotinas para controlar fluxos ass√≠ncronos.",
  "objectives": [
    "Diferenciar m√©todos s√≠ncronos e corrotinas em Unity.",
    "Configurar eventos e delegados para comunica√ß√£o entre componentes.",
    "Sincronizar estados do jogo com timers e gatilhos."
  ],
  "competencies": ["Arquitetura de gameplay", "Programa√ß√£o ass√≠ncrona", "Engenharia de software"],
  "skills": [
    "Criar corrotinas com StartCoroutine e WaitForSeconds.",
    "Disparar eventos customizados para modularizar comportamento.",
    "Registrar listeners e remover subscri√ß√µes com seguran√ßa."
  ],
  "outcomes": [
    "Implementa corrotinas para sequ√™ncias temporizadas.",
    "Integra eventos para desacoplar componentes.",
    "Documenta fluxos reativos no GDD t√©cnico."
  ],
  "prerequisites": ["Fundamentos de C# na Unity.", "Conhecimento de loops e condicionais."],
  "tags": ["unity", "corrotinas", "eventos"],
  "duration": 150,
  "modality": "in-person",
  "resources": [
    {
      "label": "Unity Manual ‚Äì Coroutines",
      "url": "https://docs.unity3d.com/Manual/Coroutines.html",
      "type": "documentation"
    },
    {
      "label": "Unity Events Tutorial",
      "url": "https://learn.unity.com/tutorial/events-and-delegates",
      "type": "course"
    }
  ],
  "bibliography": [
    "HARRISON, T. Learning C# by Developing Games with Unity. Packt, 2023.",
    "Unity Technologies. Events and Messaging Systems. 2024."
  ],
  "assessment": {
    "type": "practical",
    "description": "Desafio guiado de sequ√™ncia temporal com feedback da turma."
  },
  "metadata": {
    "status": "published",
    "updatedAt": "2025-02-05T00:00:00.000Z",
    "owners": ["Prof. Tiago Sombra"],
    "sources": ["Plano de ensino TDJD 2025.1"]
  }
}
